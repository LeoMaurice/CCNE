<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mémoire Léopold Maurice sur les avis du CCNE</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            margin: 0;
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }
        #main-content {
            flex: 1;
            padding: 20px;
            order: 2;
        }
        #sidebar {
            width: 100%;
            padding: 20px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ccc;
            order: 1;
        }
        #toggle-sidebar {
            display: none;
            position: absolute;
            right: 10px;
            top: 10px;
            z-index: 2;
            background-color: #333;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
        }
        #pdf-viewer {
            width: 100%;
            height: 600px;
            border: none;
        }
        h1 {
            font-size: 24px;
        }
        @media (min-width: 768px) {
            body {
                flex-direction: row;
            }
            #sidebar {
                width: 300px;
                border-bottom: none;
                border-left: 1px solid #ccc;
                order: 0;
                height: auto;
            }
            #main-content {
                order: 1;
            }
            #toggle-sidebar {
                display: none;
            }
        }
    </style>
    <link rel="stylesheet" href="pdfjs/web/viewer.css">
</head>
<body>
    <button id="toggle-sidebar" onclick="toggleSidebar()">☰</button>
    <div id="sidebar">
        <h2>Ressources</h2>
        <p><a href="https://leomaurice.github.io/CCNE/" target="_blank">Site du mémoire</a></p>
        <h2>Contexte</h2>
        <p>Ce mémoire explore les avis du Comité Consultatif National d'Éthique (CCNE). Il analyse le traitement de la personne dans les avis, et le réseau de citations. Il s'agit d'une recherche menée par Léopold Maurice, sous la supervision d'Emmanuel Didier et de Samuel Coavoux.</p>
    </div>
    <div id="main-content">
        <h1>Mémoire Léopold Maurice sur les avis du CCNE</h1>
        <div id="pdf-viewer" class="pdfViewer"></div>
        <button id="download-pdf">Télécharger le PDF</button>
    </div>

    <script type="module">
        import { getDocument, GlobalWorkerOptions } from './pdfjs/build/pdf.mjs';

        function toggleSidebar() {
            var sidebar = document.getElementById("sidebar");
            if (sidebar.style.display === "block") {
                sidebar.style.display = "none";
            } else {
                sidebar.style.display = "block";
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            var pdfPath = 'memoire.pdf';
            GlobalWorkerOptions.workerSrc = './pdfjs/build/pdf.worker.mjs';

            var loadingTask = getDocument(pdfPath);
            loadingTask.promise.then(function(pdf) {
                console.log('PDF loaded');

                var container = document.getElementById('pdf-viewer');
                var scale = 1.5;

                for (var pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    pdf.getPage(pageNum).then(function(page) {
                        var viewport = page.getViewport({ scale: scale });

                        var canvas = document.createElement('canvas');
                        container.appendChild(canvas);
                        var context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        var renderContext = {
                            canvasContext: context,
                            viewport: viewport
                        };
                        page.render(renderContext);
                    });
                }
            }, function(reason) {
                console.error(reason);
            });

            document.getElementById('download-pdf').addEventListener('click', function() {
                var link = document.createElement('a');
                link.href = pdfPath;
                link.download = 'memoire.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
        });
    </script>
</body>
</html>